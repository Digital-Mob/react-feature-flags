"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));const FEATURE_FLAGS_STORAGE_KEY="feature:flags",FEATURE_FLAGS_REFRESH_INTERVAL=3e5,FeatureFlagsContext=React.createContext(new Map);function loadFeatureFlags(){const e=window.localStorage.getItem(FEATURE_FLAGS_STORAGE_KEY);if(e)try{const t=JSON.parse(e);if((t.createdAt||0)+FEATURE_FLAGS_REFRESH_INTERVAL>=Date.now())return new Map(t.flags)}catch(e){}}function storeFeatureFlags(e){if(e&&e.size>0){const t=JSON.stringify({flags:Array.from(e.entries()),createdAt:Date.now()});window.localStorage.setItem(FEATURE_FLAGS_STORAGE_KEY,t)}else window.localStorage.removeItem(FEATURE_FLAGS_STORAGE_KEY)}function fetchFeaturesFlags(e){return window.fetch(e).then(e=>e.json()).then(e=>{return(e&&e.featureFlags||[]).reduce((e,t)=>(t.enabled&&e.set(t.name,t),e),new Map)})}const useFeatureFlags=()=>{const e=React.useContext(FeatureFlagsContext);return React.useMemo(()=>[new Map(e)],[e])},FeatureFlagsProvider=({children:e,url:t,refreshInterval:a=FEATURE_FLAGS_REFRESH_INTERVAL})=>{const[r,s]=React.useState({featureFlags:new Map}),n=React.useCallback(()=>{fetchFeaturesFlags(t).then(e=>{s(t=>({...t,featureFlags:e})),storeFeatureFlags(e)})},[t]);return React.useEffect(()=>{const e=loadFeatureFlags();e?s(t=>({...t,featureFlags:e})):n();const t=setInterval(()=>{n()},a);return()=>{clearInterval(t)}},[]),React.createElement(FeatureFlagsContext.Provider,{value:r.featureFlags},e)},FeatureFlagsWidget=({children:e,flags:t,exact:a=!0,fallback:r})=>{const[s]=useFeatureFlags(),n=[].concat(t||[]);return(a?n.every(e=>s.has(e)):n.some(e=>s.has(e)))?e:r&&r()||null};exports.FeatureFlagsProvider=FeatureFlagsProvider,exports.FeatureFlagsWidget=FeatureFlagsWidget,exports.useFeatureFlags=useFeatureFlags;
