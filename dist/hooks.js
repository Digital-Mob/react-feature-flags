"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));const FEATURE_FLAGS_STORAGE_KEY="feature:flags",FEATURE_FLAGS_REFRESH_INTERVAL=3e5,loadFeatureFlags=()=>{const e=window.localStorage.getItem("feature:flags");if(e)try{return new Map(JSON.parse(e))}catch(e){}},storeFeatureFlags=e=>{if(e&&e.size>0){const t=JSON.stringify(Array.from(e.entries()));window.localStorage.setItem("feature:flags",t)}else window.localStorage.removeItem("feature:flags")},fetchFeaturesFlags=e=>window.fetch(e).then(e=>e.json()).then(e=>{return(e&&e.featureFlags||[]).reduce((e,t)=>(t.enabled&&e.set(t.name,t),e),new Map)}),FeatureFlagsContext=React.createContext(new Map),FeatureFlagsProvider=({children:e,url:t,refreshInterval:a=3e5})=>{const[r,s]=React.useState({featureFlags:new Map}),l=React.useCallback(()=>{fetchFeaturesFlags(t).then(e=>{s(t=>({...t,featureFlags:e})),storeFeatureFlags(e)})},[t]);return React.useEffect(()=>{const e=loadFeatureFlags();e&&s(t=>({...t,featureFlags:e})),l();const t=setInterval(()=>{l()},a);return()=>{clearInterval(t)}},[]),React.createElement(FeatureFlagsContext.Provider,{value:r.featureFlags},e)},useFeatureFlags=()=>{const e=React.useContext(FeatureFlagsContext);return React.useMemo(()=>[new Map(e)],[e])},FeatureFlagsWidget=({children:e,flags:t,exact:a=!0,fallback:r})=>{const[s]=useFeatureFlags(),l=[].concat(t||[]);return(a?l.every(e=>s.has(e)):l.some(e=>s.has(e)))?e:r&&r()||null};exports.FeatureFlagsProvider=FeatureFlagsProvider,exports.FeatureFlagsWidget=FeatureFlagsWidget,exports.useFeatureFlags=useFeatureFlags;
