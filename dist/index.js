"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));const FEATURE_FLAGS_STORAGE_KEY="feature:flags",FEATURE_FLAGS_REFRESH_INTERVAL=3e5,loadFeatureFlags=()=>{const e=window.localStorage.getItem("feature:flags");if(e)try{return new Map(JSON.parse(e))}catch(e){}},storeFeatureFlags=e=>{if(e&&e.size>0){const t=JSON.stringify(Array.from(e.entries()));window.localStorage.setItem("feature:flags",t)}else window.localStorage.removeItem("feature:flags")},fetchFeaturesFlags=e=>window.fetch(e).then(e=>e.json()).then(e=>{return(e&&e.featureFlags||[]).reduce((e,t)=>(t.enabled&&e.set(t.name,t),e),new Map)}),FeatureFlagsContext=React.createContext(new Map);class FeatureFlagsProvider extends React.PureComponent{constructor(){super(...arguments),this.state={featureFlags:new Map},this.intervalID=null}componentDidMount(){const{refreshInterval:e=FEATURE_FLAGS_REFRESH_INTERVAL}=this.props,t=loadFeatureFlags();t&&this.setState(e=>({...e,featureFlags:t})),this.getFeaturesFlags(),this.intervalID=setInterval(()=>{this.getFeaturesFlags()},e)}componentWillUnmount(){this.intervalID&&(clearInterval(this.intervalID),this.intervalID=null)}render(){const{children:e}=this.props,{featureFlags:t}=this.state;return React.createElement(FeatureFlagsContext.Provider,{value:t},e)}getFeaturesFlags(){const{url:e}=this.props;fetchFeaturesFlags(e).then(e=>{this.setState(t=>({...t,featureFlags:e})),storeFeatureFlags(e)})}}const FeatureFlagsWidget=({children:e,flags:t,exact:a=!0,fallback:r})=>{const s=[].concat(t||[]);return React.createElement(FeatureFlagsContext.Consumer,null,t=>{return(a?s.every(e=>t.has(e)):s.some(e=>t.has(e)))?e:r&&r()||null})};exports.FeatureFlagsContext=FeatureFlagsContext,exports.FeatureFlagsProvider=FeatureFlagsProvider,exports.FeatureFlagsWidget=FeatureFlagsWidget;
